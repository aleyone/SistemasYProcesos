package es.syp4.ae4;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.ServerSocket;
import java.net.Socket;

public class Server {

	public static void main(String[] args) {
		int puerto = 1234;
		try {
			ServerSocket servidor = new ServerSocket(puerto);
			System.err.println("SERVIDOR >>> Waiting for connection....");
			Socket clientConnection = servidor.accept();
			Thread.sleep(3000);
			ObjectOutputStream outObject = new ObjectOutputStream(clientConnection.getOutputStream());
			Password pass = new Password("Texto Plano");
			outObject.writeObject(pass);
			System.err.println("SERVIDOR >>> Sending empty object: "+pass.getTextPass());
			ObjectInputStream inObject = new ObjectInputStream(clientConnection.getInputStream());
			Password modPass = (Password) inObject.readObject();
			Thread.sleep(3000);
			System.err.println("SERVIDOR >>> Receiving data from user: "+modPass.getTextPass());
			InputStream is = clientConnection.getInputStream();
			InputStreamReader isr = new InputStreamReader(is);
			BufferedReader bf = new BufferedReader(isr);
			System.err.println("SERVIDOR >>> Encryption mode...");
			int opcion = Integer.parseInt(bf.readLine());
			if (opcion == 1) {
				modPass.AsciiEnc(modPass.getTextPass());
			} else if (opcion == 2) {
				modPass.MD5Enc("myKey", modPass.getTextPass());
			}
			outObject = new ObjectOutputStream(clientConnection.getOutputStream());
			outObject.writeObject(modPass);
			System.err.println("SERVIDOR >>> Sending complete object... > "+modPass.getTextPass()+" - "+modPass.getEncryptedPass());
			outObject.close();
			inObject.close();
			clientConnection.close();
			servidor.close();
			
			
		} catch (InterruptedException e) {
		} catch (ClassNotFoundException e) {
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
	}

}
